#
# Copyright (c) Huawei Technologies Co., Ltd. 2017-2018. All rights reserved.
# Description: generated by MindStudio
# Author: Huawei
# Create: 2017-06-06
#

# before run cmake, please set DDK_PATH, TOOLS_PATH path to environment
# eg: ubuntu16.04:
cmake_minimum_required(VERSION 2.8.12)

set(DDK_DIR "$ENV{DDK_PATH}")
set(ST_DIR "$ENV{ST_TOOLS_PATH}")
set(SIMULATOR_DIR "$ENV{SIMULATOR_PATH}")
set(PROJECT_DIR "$ENV{PROJECT_PATH}")

project("stest")
set(CUSTOM_OBJECT_NAME "stest_scatter_nd_add")
# CC Flags
set(CMAKE_CXX_FLAGS "-std=c++11 -fPIC -DLOCAL_ST")


# LD Flags
if(DEFINED CAMODEL)
    set(LINK_LIB camodel tsch_camodel runtime_camodel)
    set(CMAKE_EXE_LINKER_FLAGS "-DLOCAL_ST -fsanitize=address -static-libasan -fsanitize=undefined -static-libubsan -fprofile-arcs -ftest-coverage")
else()
    set(LINK_LIB _pvmodel tsch runtime_cmodel)
    set(CMAKE_EXE_LINKER_FLAGS "-DTE_ST_MINI -DLOCAL_ST -fsanitize=address -static-libasan -fsanitize=undefined -static-libubsan")
endif()

# include
include_directories(
    "${SIMULATOR_DIR}/include"
    "${SIMULATOR_DIR}/include/model/pv_model"
    "${ST_DIR}/testcase"
    "${ST_DIR}/testcase/comm"
    "${ST_DIR}/third_party/googletest/include"
    "${ST_DIR}/third_party/mockcpp/5.4/include"
    "${ST_DIR}/third_party/mockcpp/5.4/include/3rdparty"
    "${DDK_DIR}/include/libc_sec/include"
)

# link library
link_directories(
    "${SIMULATOR_DIR}/lib"
    "${ST_DIR}/third_party/googletest/lib/5.4"
    "${ST_DIR}/third_party/mockcpp/5.4/lib"
    "${DDK_DIR}/uihost/lib"
)

# build stest
file(GLOB SOURCES "*_st.cc")
file(GLOB SUB_SOURCES "**/*_st.cc")
add_executable(${CUSTOM_OBJECT_NAME}
    ${SOURCES}
    ${SUB_SOURCES}
    ${ST_DIR}/testcase/layer.cc
    ${ST_DIR}/testcase/main.cc
)

target_link_libraries(${CUSTOM_OBJECT_NAME}
    ${LINK_LIB}
    c_sec
    slog
    gtest
    pthread
    mockcpp
)

SET(EXECUTABLE_OUTPUT_PATH "${PROJECT_DIR}/out/bin")
