#
# Copyright (c) Huawei Technologies Co., Ltd. 2017-2018. All rights reserved.
# Description: generated by MindStudio
# Author: Huawei
# Create: 2017-06-06
#

# before run cmake, please set DDK_PATH, BBIT_TOOLS_PATH path to environment
# eg: ubuntu16.04:
cmake_minimum_required(VERSION 2.8.12)

set(DDK_DIR "$ENV{DDK_PATH}")
MESSAGE( STATUS "DDKDIR is = ${DDK_DIR}.")
set(BBIT_TOOLS_DIR "$ENV{BBIT_TOOLS_PATH}")
MESSAGE( STATUS "BBIT_TOOLS_DIR is = ${BBIT_TOOLS_DIR}.")
set(CMAKE_C_COMPILER "${DDK_DIR}/toolchains/aarch64-linux-gcc6.3/bin/aarch64-linux-gnu-gcc")
set(CMAKE_CXX_COMPILER "${DDK_DIR}/toolchains/aarch64-linux-gcc6.3/bin/aarch64-linux-gnu-g++")

project("bbit_test_all")
# target
set(CUSTOM_OBJECT_NAME "tvm_bbit")

# CC Flags
set(CMAKE_CXX_FLAGS "-std=c++11 -fPIC ")

# LD Flags
set(CMAKE_EXE_LINKER_FLAGS "-Wl,-rpath-link,${BBIT_TOOLS_DIR}/lib  -Wl,--whole-archive  -Wl,--no-whole-archive \
-Wl,--start-group -Wl,--no-undefined  -Wl,--end-group -Wl,-z,relro,-z,now,-z,noexecstack ")

# include
include_directories(
    "${DDK_DIR}/include/libc_sec/include"
    "${BBIT_TOOLS_DIR}"
    "${BBIT_TOOLS_DIR}/testcase"
    "${BBIT_TOOLS_DIR}/testcase/comm"
    "${BBIT_TOOLS_DIR}/../../simulator/include"
)

# link library
link_directories(
    "${BBIT_TOOLS_DIR}/lib"
)


file(GLOB_RECURSE SOURCES "*.cc")
add_executable(${CUSTOM_OBJECT_NAME}
    ${SOURCES}
    ${BBIT_TOOLS_DIR}/testcase/layer.cc
    ${BBIT_TOOLS_DIR}/testcase/tvm_bbit.cc
    ${BBIT_TOOLS_DIR}/testcase/main.cc
    ${BBIT_TOOLS_DIR}/testcase/drv_utest_stub.cc
    ${BBIT_TOOLS_DIR}/fp16/fp16_t.cc
    ${BBIT_TOOLS_DIR}/testcase/layer.cc
)

target_link_libraries(${CUSTOM_OBJECT_NAME}
#    aicpu_engine
    crypto
    c_sec
    devmm
    drvaicpu
    drvdevdrv
    mmpa
    profilerclient
    runtime
    slog
)

SET(EXECUTABLE_OUTPUT_PATH ../../out/bin)
